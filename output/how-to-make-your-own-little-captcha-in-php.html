<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/font-awesome.min.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
<meta name="author" content="Nikolai Tschacher" />
<meta name="description" content="Hey dear readership and dudelmatz :) I'm kinda overworked and planned quite a while ago to release my own little captcha implementation to prevent this massive bulk of spam comments I receive on a daily base: It's obnoxious to scroll through this sheer amount of spam comments and delete ..." />
<meta name="keywords" content="Programming, Learning, Security">
<meta property="og:site_name" content="Coding, Learning and IT Security"/>
<meta property="og:title" content="Another wordpress catpcha implementation"/>
<meta property="og:description" content="Hey dear readership and dudelmatz :) I'm kinda overworked and planned quite a while ago to release my own little captcha implementation to prevent this massive bulk of spam comments I receive on a daily base: It's obnoxious to scroll through this sheer amount of spam comments and delete ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/how-to-make-your-own-little-captcha-in-php.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-01-25 22:01:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/nikolai-tschacher.html">
<meta property="article:section" content="Learning"/>
<meta property="article:tag" content="Programming"/>
<meta property="article:tag" content="Learning"/>
<meta property="article:tag" content="Security"/>
<meta property="og:image" content="">  <title>Coding, Learning and IT Security &ndash; Another wordpress catpcha implementation</title>
</head>
<body>
  <aside>
    <div>
      <a href="">
        <img src="/theme/img/profile.png" alt="Coding, Learning and IT Security" title="Coding, Learning and IT Security">
      </a>
      <h1><a href="">Coding, Learning and IT Security</a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="/pages/about.html#about">About</a></li>
          <li><a href="/pages/contact.html#contact">Contact</a></li>
          <li><a href="/pages/googlescraper-py.html#googlescraper-py">GoogleScraper.py</a></li>
          <li><a href="/pages/projects.html#projects">Projects</a></li>
          <li><a href="/pages/impressum.html#impressum">Site Notice</a></li>
          <li><a href="/pages/svgcaptcha.html#svgcaptcha">SVGCaptcha</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-twitter" href="https://twitter.com/incolumitas_" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/NikolaiT" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="//incolumitas/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
        <li><a class="sc-stack-overflow" href="http://stackoverflow.com/users/1052496/nikolai-tschacher" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
    </nav>

<article>
  <header>
    <h1 id="how-to-make-your-own-little-captcha-in-php">Another wordpress catpcha implementation</h1>
    <p>Posted on Fr 25 Januar 2013 in <a href="/category/learning.html">Learning</a></p>
  </header>
  <div>
    <h3>Hey dear readership and dudelmatz :)</h3>
<p>I'm kinda overworked and planned quite a while ago to release my own
little captcha implementation to prevent this massive bulk of spam
comments I receive on a daily base: It's obnoxious to scroll through
this sheer amount of spam comments and delete them. You can't just
masstrash them, because you might miss a legit comment and therefore you
need to check every single one. I assume the spammer embrace this
expected behaviour of a blogger, and therefore exploit it.</p>
<p>So I needed to put a stop to this violation of my spare time and I
created my own captcha. Of course, I first searched for a working and
already existing solution (and I am sure there are many which are better
then what I came up with), but the one I used is basically
<a href="http://wordpress.org/extend/plugins/captcha/">crap</a>.Â <a href="http://wordpress.org/extend/plugins/captcha/"><br />
</a></p>
<p>Its plugin description states:</p>
<blockquote>
<p><em>Captcha plugin allows you to protect your website from spam using
math logic which can be used for login, registration, reseting
password, comments forms.</em></p>
</blockquote>
<p>And yeah as I feared this simple elegant captcha is worthless, because
math logic is a joke to parse and solve by computers (=>spamscripts). I
was pissed and in a mood to write my first wordpress plugin, so I did my
own from scratch.</p>
<p>Well, I need to warn you: My solution is designed to work only on this
site, because it wouldn't be all too hard to crack it and to bypass its
deception. But this won't happen, because there's no reason: This site
has by far not the critical traffic (not yet) which would make it
interesting for a spammer to circumwent the captcha.</p>
<p>Well enough said, you can see the plugin in action on this site (see the
comments section). Here's the source:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="cm">/*</span>
<span class="cm">Plugin Name: CunningCaptcha</span>
<span class="cm">Plugin URI: http://incolumitas.com</span>
<span class="cm">Description: Simple/easy captcha to prevent spam at commenting.</span>
<span class="cm">Version: 0.1</span>
<span class="cm">Author: Nikolai</span>
<span class="cm">Author URI: http://incolumitas.com</span>
<span class="cm">License: GPLv2 or later</span>
<span class="cm">*/</span>

<span class="cm">/*  Copyright 2013  Nikolai  (email : admin@incolumitas.com)</span>

<span class="cm">    This program is free software; you can redistribute it and/or modify</span>
<span class="cm">    it under the terms of the GNU General Public License, version 2, as </span>
<span class="cm">    published by the Free Software Foundation.</span>

<span class="cm">    This program is distributed in the hope that it will be useful,</span>
<span class="cm">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">    GNU General Public License for more details.</span>

<span class="cm">    You should have received a copy of the GNU General Public License</span>
<span class="cm">    along with this program; if not, write to the Free Software</span>
<span class="cm">    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm"> *  A really simplistic approach to eliminate my spam problem on my</span>
<span class="cm"> *  website. Generates a captcha consisting of 4 figures and inserts</span>
<span class="cm"> *  some noise to prevent it from being cracked by skids.</span>
<span class="cm"> *  I think the effort of cracking it wouldn&#39;t take longer than 3 hours</span>
<span class="cm"> *  for an intermediate programmer. Its efectiveness lies in the captchas</span>
<span class="cm"> *  uniqueness. Generally, security by obfuscation is a bad idea. At least I </span>
<span class="cm"> *  know that :) When somebody tries to crack it, I will harden it. As long</span>
<span class="cm"> *  as you give up...</span>
<span class="cm"> */</span>

<span class="c1">// http://wpengineer.com/2214/adding-input-fields-to-the-comment-form/</span>
<span class="c1">// http://wpengineer.com/2205/comment-form-hooks-visualized/</span>

<span class="nb">define</span><span class="p">(</span><span class="s2">&quot;CCAPTCHA_DEBUG&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">CCAPTCHA_DEBUG</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
  <span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">define</span><span class="p">(</span><span class="s2">&quot;FIGURE_SIZE&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s2">&quot;NUM_BRUSH_CHANGES_MAX&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s2">&quot;PPM_FILE&quot;</span><span class="p">,</span> <span class="nx">plugin_dir_path</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;gen.ppm&quot;</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s2">&quot;CAPTCHA_PNG&quot;</span><span class="p">,</span> <span class="nx">plugin_dir_path</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;captcha.png&quot;</span><span class="p">);</span>

<span class="cm">/* Apply intercepting logic with wordpress API */</span>

<span class="c1">// Set a filter to add additional input fields for the comment</span>
<span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;comment_form_defaults&#39;</span><span class="p">,</span> <span class="s1">&#39;ccaptcha_comment_form_defaults&#39;</span><span class="p">);</span>
<span class="c1">// Add a filter to verify if the captch was correct</span>
<span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;preprocess_comment&#39;</span><span class="p">,</span> <span class="s1">&#39;ccaptcha_check&#39;</span><span class="p">);</span>
<span class="c1">// Add a action hook to add the additioal field to the db</span>
<span class="nx">add_action</span><span class="p">(</span><span class="s1">&#39;comment_post&#39;</span><span class="p">,</span> <span class="s1">&#39;ccaptcha_save_input&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">ccaptcha_save_input</span><span class="p">(</span><span class="nv">$comment_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">add_comment_meta</span><span class="p">(</span><span class="nv">$comment_id</span><span class="p">,</span>
            <span class="s1">&#39;ccaptcha&#39;</span><span class="p">,</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">]));</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">ccaptcha_check</span><span class="p">(</span><span class="nv">$commentdata</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$current_user</span><span class="p">;</span>
    <span class="nx">get_currentuserinfo</span><span class="p">();</span>
    <span class="nv">$uid</span> <span class="o">=</span> <span class="nv">$current_user</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$uid</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">]))</span>
          <span class="nx">wp_die</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Error: You need to enter the captcha.&#39;</span><span class="p">));</span>

        <span class="nv">$answer</span> <span class="o">=</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">]);</span>
        <span class="nv">$generated</span> <span class="o">=</span> <span class="nx">get_option</span><span class="p">(</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">strcasecmp</span><span class="p">(</span><span class="nv">$answer</span><span class="p">,</span> <span class="nv">$generated</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
          <span class="nx">wp_die</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Error: Your supplied captcha is incorrect.&#39;</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$commentdata</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Create the captcha and store the string in the database.</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="nf">ccaptcha_comment_form_defaults</span><span class="p">(</span><span class="nv">$default</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$answer</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">ccaptcha_generate</span><span class="p">());</span>

    <span class="c1">// Well, that is ugly, but how else?</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">get_option</span><span class="p">(</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">))</span>
        <span class="nx">add_option</span><span class="p">(</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">,</span> <span class="nv">$answer</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="nx">update_option</span><span class="p">(</span><span class="s1">&#39;ccaptcha&#39;</span><span class="p">,</span> <span class="nv">$answer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_user_logged_in</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$default</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">.=</span> 
            <span class="s1">&#39;&lt;img id=&quot;captcha_image&quot; src=&quot;&#39;</span><span class="o">.</span><span class="nx">__</span><span class="p">(</span><span class="nx">plugin_dir_url</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">))</span><span class="o">.</span><span class="s1">&#39;captcha.png&quot;&gt;</span>
<span class="s1">            &lt;p class=&quot;comment-form-captcha&quot;&gt;</span>
<span class="s1">            &lt;label for=&quot;captcha&quot;&gt;&#39;</span><span class="o">.</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;Captcha&#39;</span><span class="p">)</span><span class="o">.</span> <span class="s1">&#39;&lt;/label&gt;</span>
<span class="s1">            &lt;input id=&quot;ccaptcha&quot; name=&quot;ccaptcha&quot; size=&quot;30&quot; type=&quot;text&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$default</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/*** CunningCaptcha Logic begins ***/</span>

<span class="k">function</span> <span class="nf">ccaptcha_generate</span><span class="p">()</span> <span class="p">{</span>

  <span class="nv">$h</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nx">PPM_FILE</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$h</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;fopen() error&quot;</span><span class="p">;</span>
  <span class="nb">var_dump</span><span class="p">(</span><span class="nb">error_get_last</span><span class="p">());</span>
  <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nv">$figures</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="nv">$str</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="nv">$index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$choose</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

      <span class="k">switch</span> <span class="p">(</span><span class="nv">$choose</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
            <span class="nv">$figures</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">get_1</span><span class="p">();</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="nv">$figures</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">get_7</span><span class="p">();</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;7&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="nv">$figures</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">get_E</span><span class="p">();</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
            <span class="nv">$figures</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">get_Z</span><span class="p">();</span> <span class="nv">$str</span><span class="p">[</span><span class="nv">$index</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">default</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="nv">$captcha</span> <span class="o">=</span> <span class="nx">glue_figures</span><span class="p">(</span><span class="nv">$figures</span><span class="p">);</span>

  <span class="nv">$width</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">*</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$figures</span><span class="p">);</span>
  <span class="nv">$height</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$captcha</span><span class="p">);</span>

  <span class="cm">/* write the ppm header */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="s2">&quot;P3</span><span class="se">\n</span><span class="si">$width</span><span class="s2"> </span><span class="si">$height\n255\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;fwrite(header) failed&#39;</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$height</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nv">$width</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$captcha</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$h</span><span class="p">);</span>

  <span class="cm">/* Convert to png and remove ppm */</span>
  <span class="nb">system</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;pnmtopng %s &gt; %s &amp;&amp; rm %s;&quot;</span><span class="p">,</span>
                <span class="nx">PPM_FILE</span><span class="p">,</span> <span class="nx">CAPTCHA_PNG</span><span class="p">,</span> <span class="nx">PPM_FILE</span><span class="p">));</span>

  <span class="k">return</span> <span class="nv">$str</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Glue the figures together. Expects an array of figures. Returns</span>
<span class="cm"> * a single array representing the bitmap, ready to print...</span>
<span class="cm"> */</span>
<span class="k">function</span> <span class="nf">glue_figures</span><span class="p">(</span><span class="nv">$array_figures</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$captcha</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>
    <span class="nv">$off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nv">$pad_size</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$pad_size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">$pad_size</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// make even</span>

    <span class="nv">$pad_size</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nv">$shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$index</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array_figures</span><span class="p">);</span> <span class="nv">$index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$shift</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$pad_size</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="o">+</span><span class="nv">$pad_size</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nv">$off</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">*</span> <span class="nv">$index</span> <span class="o">+</span> <span class="nv">$j</span><span class="p">;</span>
          <span class="nv">$captcha</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$off</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_grey</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">&gt;</span> <span class="nv">$pad_size</span> <span class="o">&amp;&amp;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="o">+</span><span class="nv">$pad_size</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$captcha</span><span class="p">[</span><span class="nv">$i</span><span class="o">-</span><span class="nv">$shift</span><span class="p">][</span><span class="nv">$off</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$array_figures</span><span class="p">[</span><span class="nv">$index</span><span class="p">][</span><span class="nv">$i</span><span class="o">-</span><span class="nv">$pad_size</span><span class="p">][</span><span class="nv">$j</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$captcha</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get a random grey scale color to make some noise :) */</span>
<span class="k">function</span> <span class="nf">rand_grey</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$grey</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%s %s %s&quot;</span><span class="p">,</span> <span class="nv">$grey</span><span class="p">,</span> <span class="nv">$grey</span><span class="p">,</span> <span class="nv">$grey</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Get a random color */</span>
<span class="k">function</span> <span class="nf">rand_color</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">sprintf</span>
    <span class="p">(</span>
            <span class="s2">&quot;%s %s %s&quot;</span><span class="p">,</span>
            <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
            <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_1</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$one</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>
  <span class="c1">// Apply a random shift</span>
  <span class="nv">$r_offset</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
  <span class="c1">// the number of changing the brush color of the figure</span>
  <span class="nv">$n_color_changes</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">/</span> 
            <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">NUM_BRUSH_CHANGES_MAX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Get a random brush</span>
  <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="nv">$n_color_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Fill the rest with greyscale colors</span>
    <span class="nv">$one</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_grey</span><span class="p">();</span>

    <span class="c1">// The tree of the &#39;1&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="o">||</span> 
        <span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="nv">$r_offset</span><span class="p">)</span> <span class="p">{</span>
       <span class="nv">$one</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// The hook of the &#39;1&#39;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nv">$i</span> <span class="o">+</span> <span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="o">&amp;&amp;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span> <span class="o">+</span> <span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="o">&amp;&amp;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="nv">$one</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$one</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_7</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$seven</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>
  <span class="c1">// Apply a random shift</span>
  <span class="nv">$r_offset</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
  <span class="c1">// the number of changing the brush color of the figure</span>
  <span class="nv">$n_color_changes</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">/</span> 
            <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">NUM_BRUSH_CHANGES_MAX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Get a random brush</span>
  <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="nv">$n_color_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// Fill the rest with greyscale colors</span>
      <span class="nv">$seven</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_grey</span><span class="p">();</span>

      <span class="c1">// The roof of the &#39;7&#39;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nv">$i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
              <span class="nv">$j</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="nv">$seven</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="o">-</span><span class="nv">$r_offset</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>

      <span class="c1">// The tree of the &#39;7&#39;</span>
      <span class="k">if</span> <span class="p">(</span>  <span class="p">(</span><span class="nv">$i</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>      <span class="o">||</span>
            <span class="p">(</span><span class="nv">$i</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>    <span class="o">||</span>
            <span class="p">((</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>  <span class="o">||</span>
            <span class="p">((</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="p">)</span>
        <span class="nv">$seven</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$seven</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_Z</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">$z</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>
  <span class="c1">// Apply a random shift</span>
  <span class="nv">$r_offset</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
  <span class="c1">// the number of changing the brush color of the figure</span>
  <span class="nv">$n_color_changes</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">/</span> 
            <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">NUM_BRUSH_CHANGES_MAX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Get a random brush</span>
  <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="nv">$n_color_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// Fill the rest with greyscale colors</span>
      <span class="nv">$z</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_grey</span><span class="p">();</span>

      <span class="c1">// The roof and soil of the &#39;Z&#39;</span>
      <span class="k">if</span> <span class="p">(((</span><span class="nv">$i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> 
          <span class="p">(</span><span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
           <span class="nv">$j</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="nv">$z</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="o">-</span><span class="nv">$r_offset</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>

      <span class="c1">// The tree of the &#39;Z&#39;</span>
      <span class="k">if</span> <span class="p">(</span>  <span class="p">(</span><span class="nv">$i</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>      <span class="o">||</span>
            <span class="p">(</span><span class="nv">$i</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>    <span class="o">||</span>
            <span class="p">((</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span>  <span class="o">||</span>
            <span class="p">((</span><span class="nv">$i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="p">)</span>
        <span class="nv">$z</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$z</span><span class="p">;</span> 
<span class="p">}</span>

<span class="k">function</span> <span class="nf">get_E</span><span class="p">()</span> <span class="p">{</span>  
  <span class="nv">$e</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>
  <span class="c1">// Apply a random shift</span>
  <span class="nv">$r_offset</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
  <span class="c1">// the number of changing the brush color of the figure</span>
  <span class="nv">$n_color_changes</span> <span class="o">=</span> <span class="nx">FIGURE_SIZE</span> <span class="o">/</span> 
            <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">NUM_BRUSH_CHANGES_MAX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="c1">// Get a random brush</span>
  <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">%</span> <span class="nv">$n_color_changes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nv">$brush</span> <span class="o">=</span> <span class="nx">rand_color</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">FIGURE_SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// Fill the rest with greyscale colors</span>
      <span class="nv">$e</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rand_grey</span><span class="p">();</span>

      <span class="c1">// The left vertical bar</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nv">$r_offset</span> <span class="o">||</span>
          <span class="nv">$j</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="nv">$r_offset</span><span class="p">)</span>
        <span class="nv">$e</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>

      <span class="c1">// The three balks of the &#39;E&#39;</span>
      <span class="k">if</span> <span class="p">(((</span><span class="nv">$i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> 
          <span class="p">(</span><span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">||</span>
          <span class="p">(</span><span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nv">$i</span> <span class="o">==</span> <span class="nx">FIGURE_SIZE</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
          <span class="cm">/* prevent out of bounds indices */</span>
          <span class="o">&amp;&amp;</span> <span class="nv">$j</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">FIGURE_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="nv">$e</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="nv">$j</span><span class="o">-</span><span class="nv">$r_offset</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$brush</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$e</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/programming.html">Programming</a>
      <a href="/tag/learning.html">Learning</a>
      <a href="/tag/security.html">Security</a>
    </p>
  </div>
</article>

    <footer>
      <p>&copy; Nikolai Tschacher 2015</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Another wordpress catpcha implementation",
  "headline": "Another wordpress catpcha implementation",
  "datePublished": "2013-01-25 22:01:00+01:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Nikolai Tschacher",
    "url": "/author/nikolai-tschacher.html"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "/how-to-make-your-own-little-captcha-in-php.html",
  "description": "Hey dear readership and dudelmatz :) I'm kinda overworked and planned quite a while ago to release my own little captcha implementation to prevent this massive bulk of spam comments I receive on a daily base: It's obnoxious to scroll through this sheer amount of spam comments and delete ..."
}
</script></body>
</html>